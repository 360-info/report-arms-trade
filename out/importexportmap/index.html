<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Weapon transfers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>


<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../style/embed.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="../style/modal.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maplibre-gl@2.1.9/dist/maplibre-gl.css">
<link rel="stylesheet" href="../style/map.css">
</head>

<body>


<header id="title-block-header">
<h1 class="title">Weapon transfers</h1>
<p class="subtitle">Where are arms going?</p>


</header>

<div class="modalpanel">
<!-- check https://icons.getbootstrap.com for icons! -->
<p><a href="#" data-micromodal-trigger="modal-useremix" tabindex="0"> <i class="bi bi-share-fill"></i> Share </a></p>
<p><a href="#" data-micromodal-trigger="modal-about" tabindex="0"> <i class="bi bi-info-circle-fill"></i> Info </a></p>
<p><a id="fullscreenButton" href="#"> <span class="fsoff"> <i class="bi bi-arrows-fullscreen"></i> Full </span> </a></p>
<script>
  window.addEventListener("load", () => {
    document.querySelector("#fullscreenButton").addEventListener("click", e => {
      e.preventDefault();
      console.log("FS button clicked!");

      var fsBtn = document.querySelector("#fullscreenButton");

      if (fsBtn.classList.contains("fsmode")) {
        // fullscreen is on: disable it
        document.exitFullscreen();
        fsBtn.classList.remove("fsmode")
      } else {
        // fullscreen is off: enable it
        var rootEl = document.documentElement;

        var requestMethod =
          rootEl.requestFullScreen ||
          rootEl.webkitRequestFullScreen ||
          rootEl.mozRequestFullScreen ||
          rootEl.msRequestFullScreen;

          if (requestMethod) {
            requestMethod.call(rootEl);
            fsBtn.classList.add("fsmode");
          } else {
            alert("Fullscreen mode isn't supported on this browser.")
          }
      }

      // Can also cancel the event and manually navigate
      // window.location = e.target.href;
      });
  })
</script>
<!-- if there's room here, put credits on two lines:
  * Editor names, 360info (hint: put &shy; in the middle of long names!)
  * Data: ORG
  (if there isn't room, put it in the ABOUT dialog) -->
<!-- Editor Name, 360info

Data: ORG -->
</div>
<div id="libraries" class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="27" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 26;"><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> require<span class="op">.</span><span class="fu">alias</span>({</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maplibregl</span><span class="op">:</span> <span class="st">"maplibre-gl@2.1.9/dist/maplibre-gl.js"</span><span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">h3</span><span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">deck</span><span class="op">:</span> <span class="st">"deck.gl@latest/dist.min.js"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>maplibregl <span class="op">=</span> <span class="fu">r</span>(<span class="st">"maplibregl"</span>)<span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="bu">window</span>[<span class="st">"maplibregl"</span>])<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>deck <span class="op">=</span> <span class="fu">r</span>(<span class="st">"deck"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="libraries-1">
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="libraries-2">
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="libraries-3">
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div id="inputs" class="cell inputForm">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="46" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 45;"><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>viewof selectedYear <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1950</span><span class="op">,</span> <span class="dv">2021</span>]<span class="op">,</span> {</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Year"</span><span class="op">,</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">2021</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>viewof selectedCountry <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Who"</span> })<span class="op">;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>viewof layerType <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Arcs"</span><span class="op">,</span> <span class="st">"Great circles"</span>]<span class="op">,</span> {</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Layer type"</span><span class="op">,</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"Arcs"</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="inputs-1">
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="inputs-2">
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="inputs-3">
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div id="arc-layer" class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="65" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 64;"><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>widthScale <span class="op">=</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">4500</span>]) </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="fl">0.25</span><span class="op">,</span> <span class="dv">30</span>])<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>transferArcs <span class="op">=</span> <span class="kw">new</span> deck<span class="op">.</span><span class="fu">MapboxLayer</span>({</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">"transferArcs"</span><span class="op">,</span> </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> deck<span class="op">.</span><span class="at">ArcLayer</span><span class="op">,</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getSourcePosition</span><span class="op">:</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> [<span class="bu">Number</span>(d<span class="op">.</span><span class="at">supplier_lon</span>)<span class="op">,</span> <span class="bu">Number</span>(d<span class="op">.</span><span class="at">supplier_lat</span>)]<span class="op">,</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getTargetPosition</span><span class="op">:</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> [<span class="bu">Number</span>(d<span class="op">.</span><span class="at">recipient_lon</span>)<span class="op">,</span> <span class="bu">Number</span>(d<span class="op">.</span><span class="at">recipient_lat</span>)]<span class="op">,</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getSourceColor</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">102</span>]<span class="op">,</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getTargetColor</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">204</span>]<span class="op">,</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getWidth</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">widthScale</span>(d<span class="op">.</span><span class="at">count</span>)<span class="op">,</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pickable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  <span class="dt">autoHighlight</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="dt">highlightColor</span><span class="op">:</span> [<span class="dv">255</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">255</span>]</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="arc-layer-1">
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="arc-layer-2">
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="87" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 86;"><span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>popup <span class="op">=</span> <span class="kw">new</span> maplibregl<span class="op">.</span><span class="fu">Popup</span>({</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>  <span class="dt">closeButton</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  <span class="dt">closeOnClick</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="95" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 94;"><span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a><span class="co">/* this is a bit different to regular mapbox/maplibre instantiation</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a><span class="co">   it lets have the map react to other values in the document, like</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a><span class="co">   a button or a timer, without reinstantiating!</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a><span class="co">   (based on https://observablehq.com/@tmcw/using-mapbox-gl-js) */</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>viewof map <span class="op">=</span> {</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="position: absolute; left: 0; top: 0; height: 100vh; width: 100%;" /&gt;`</span><span class="op">;</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Give the container dimensions.</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">yield</span> container<span class="op">;</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the \`map\` object with the mapboxgl.Map constructor, referencing</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the container div</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> map <span class="op">=</span> <span class="kw">new</span> maplibregl<span class="op">.</span><span class="fu">Map</span>({</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    container<span class="op">,</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">center</span><span class="op">:</span> [<span class="dv">40</span><span class="op">,</span> <span class="dv">40</span>]<span class="op">,</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="dt">zoom</span><span class="op">:</span> <span class="fl">1.25</span><span class="op">,</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pitch</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pickingRadius</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">antialias</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> <span class="st">"style.json"</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>  <span class="co">// on map load:</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// - dispatch its value back to ojs</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>  <span class="co">// - add the deck.gl layer to the map</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">// - add a prop to the layer that adds/removes a popup from the map</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   (we can't do this on initial layer def because the map isn't ready yet)</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>  map<span class="op">.</span><span class="fu">on</span>(<span class="st">"load"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="at">value</span> <span class="op">=</span> map<span class="op">;</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">addLayer</span>(transferArcs)<span class="op">;</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">updatePopup</span>(info<span class="op">,</span> <span class="bu">event</span>) {</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (info <span class="op">&amp;&amp;</span> info<span class="op">.</span><span class="at">object</span>) {</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>          <span class="co">// </span><span class="al">TODO</span><span class="co"> - set coordinates with event.center?</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>          popup</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setLngLat</span>(info<span class="op">.</span><span class="at">coordinate</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setHTML</span>(</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>              <span class="vs">`</span><span class="sc">${</span>info<span class="op">.</span><span class="at">object</span><span class="op">.</span><span class="at">supplier</span><span class="sc">}</span><span class="vs"> → </span><span class="sc">${</span>info<span class="op">.</span><span class="at">object</span><span class="op">.</span><span class="at">recipient</span><span class="sc">}</span><span class="vs">&lt;/br&gt;</span></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a><span class="vs">              TIV </span><span class="sc">${</span>info<span class="op">.</span><span class="at">object</span><span class="op">.</span><span class="at">count</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"$"</span> <span class="op">+</span> info<span class="op">.</span><span class="at">object</span><span class="op">.</span><span class="at">count</span> <span class="op">:</span> <span class="st">"&lt; $0.5"</span><span class="sc">}</span><span class="vs"> M`</span>)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>          popup<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    transferArcs<span class="op">.</span><span class="fu">setProps</span>({</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onHover</span><span class="op">:</span> updatePopup</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="map" class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div id="load-and-filter-data" class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="158" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 157;"><span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>allTransfers <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"sipri-exports-processed.csv"</span>)</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a><span class="co">/* the dataset is filtered first by selected year, then by search term</span></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a><span class="co">   (we use a separate text input instead of the search's because we want to</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a><span class="co">   retain the search term when the year changes) */</span></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>filteredTransfers <span class="op">=</span> allTransfers<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>  t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">year</span> <span class="op">==</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>    (t<span class="op">.</span><span class="at">supplier</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">.</span><span class="fu">includes</span>(selectedCountry<span class="op">.</span><span class="fu">toLowerCase</span>()) <span class="op">||</span></span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>     t<span class="op">.</span><span class="at">recipient</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">.</span><span class="fu">includes</span>(selectedCountry<span class="op">.</span><span class="fu">toLowerCase</span>())))<span class="op">;</span></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>arcType <span class="op">=</span> layerType <span class="op">==</span> <span class="st">"Arcs"</span> <span class="op">?</span> deck<span class="op">.</span><span class="at">ArcLayer</span> <span class="op">:</span> deck<span class="op">.</span><span class="at">GreatCircleLayer</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="load-and-filter-data-1">
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="load-and-filter-data-2">
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="load-and-filter-data-3">
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="175" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 174;"><span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>transferArcs<span class="op">.</span><span class="fu">setProps</span>({ <span class="dt">data</span><span class="op">:</span> filteredTransfers<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> arcType })<span class="op">;</span></span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co"> - maybe update map bounds based on bounds of currentYearTransfers?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="update-arcs" class="cell-output cell-output-display hidden">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
</div>
</div>
<!-- share/about popups -->
<!-- initialise miromodal.js -->
<div class="cell" data-include="false">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="1" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>micro <span class="op">=</span> <span class="pp">require</span>(<span class="st">"micromodal@0.4.10"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>micro<span class="op">.</span><span class="fu">init</span>({</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">awaitOpenAnimation</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">awaitCloseAnimation</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-8-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div id="modal-useremix" class="modal micromodal-slide" aria-hidden="true">
<div class="modal__overlay" tabindex="-1" data-micromodal-close="true">
<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-useremix-title">
<button class="modal__close" aria-label="Close modal" data-micromodal-close="">
</button>
<div id="modal-useremix-content">
<h2 id="use-remix" class="anchored">Use + Remix</h2>
<p>These charts, as well as the analyses that underpin them, are available under a <a href="https://creativecommons.org/licenses/by/4.0"><strong>Creative Commons Attribution 4.0 licence</strong></a>.</p>
<p>Please acknowledge <a href="https://360info.org">360info</a> and our data sources when you use these charts and data.</p>
<h4 id="embed-this-chart-in-your-article" class="anchored">Embed this chart in your article</h4>
<p>Copy and paste the following code:</p>
<div class="embedcode">
<pre><code>&lt;iframe
src="https://360info-studentflows.pages.dev/
embed-netflow-scatter" title="Chart with Human
Development Index increasing to the right and Net
Student Ratio increasing upward. Countries situated
above the line, in blue, are receiving more
students from other countries than they send out."
width="550" height="560" scrolling="no"
style="border:none;"&gt;&lt;/iframe&gt;</code></pre>
</div>
<p>This content is subject to <a href="https://newshub.360info.org/page/terms">360info’s Terms of Use</a>.</p>
<h4 id="get-the-data-and-code" class="anchored">Get the data and code</h4>
<p>Visit the <a href="https://github.com/360-info/report-template/tree/main/data">GitHub repository</a> to:</p>
<ul>
<li><a href="https://github.com/360-info/report-template/tree/main/data"><strong>Download the data</strong></a></li>
<li><a href="https://github.com/360-info/report-template"><strong>Recreate or remix the chart</strong></a></li>
</ul>
</div>
</div>
</div>
</div>
<!-- notes dialog -->
<div id="modal-about" class="modal micromodal-slide" aria-hidden="true">
<div class="modal__overlay" tabindex="-1" data-micromodal-close="true">
<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-about-title">
<button class="modal__close" aria-label="Close modal" data-micromodal-close="">
</button>
<header>
<h2 id="modal-about-title" class="anchored">What do these numbers mean?</h2>
</header>
<div id="modal-about-content">
<p><strong>Trend Indicator Value</strong> (TIV) is a kind of price that SIPRI, the provider of this dataset, puts on arms transfers. It doesn’t measure the financial value of the arms transferred but rather the military capability they provide.</p>
<p>This is important because different kinds of arms are developed over time, while others might change in price based on external factors.</p>
<p>But the deadliness of a gun doesn’t typically change. The TIV helps us compare which countries are contributing or benefitting the most from arms transfers, and how a country’s transfers have change over time.</p>
<p>To learn more about how these numbers are calculated, <a href="https://www.sipri.org/sites/default/files/files/FS/SIPRIFS1212.pdf"><strong>read SIPRI’s factsheet</strong></a>.</p>
</div>
</div>
</div>
</div>


<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"\nr = require.alias({\n  maplibregl: \"maplibre-gl@2.1.9/dist/maplibre-gl.js\",\n  h3: {},\n  deck: \"deck.gl@latest/dist.min.js\"\n});\n\nmaplibregl = r(\"maplibregl\").catch(() => window[\"maplibregl\"]);\ndeck = r(\"deck\");\n\n/* animated arcs:\n   https://observablehq.com/@yarynam/animated-deck-gl-arcs\n   https://symbolixau.github.io/mapdeck/articles/layers.html#animated-arcs */\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"\nviewof selectedYear = Inputs.range([1950, 2021], {\n  label: \"Year\",\n  step: 1,\n  value: 2021\n});\n\nviewof selectedCountry = Inputs.text({ label: \"Who\" });\n\nviewof layerType = Inputs.select(\n  [\"Arcs\", \"Great circles\"], {\n    label: \"Layer type\",\n    value: \"Arcs\"\n  });\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"\nwidthScale =\n  d3.scaleLinear()\n  .domain([0, 4500]) \n  .range([0.25, 30]);\n\ntransferArcs = new deck.MapboxLayer({\n  id: \"transferArcs\", \n  type: deck.ArcLayer,\n  data: [],\n  getSourcePosition:\n    d => [Number(d.supplier_lon), Number(d.supplier_lat)],\n  getTargetPosition:\n    d => [Number(d.recipient_lon), Number(d.recipient_lat)],\n  getSourceColor: [0, 0, 0, 102],\n  getTargetColor: [0, 128, 255, 204],\n  getWidth: d => widthScale(d.count),\n  pickable: true,\n  autoHighlight: true,\n  highlightColor: [255, 0, 0, 255]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"popup = new maplibregl.Popup({\n  closeButton: false,\n  closeOnClick: false\n});\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"\n/* this is a bit different to regular mapbox/maplibre instantiation\n   it lets have the map react to other values in the document, like\n   a button or a timer, without reinstantiating!\n   (based on https://observablehq.com/@tmcw/using-mapbox-gl-js) */\n   \nviewof map = {\n  let container = html`<div style=\"position: absolute; left: 0; top: 0; height: 100vh; width: 100%;\" />`;\n\n  // Give the container dimensions.\n  yield container;\n\n  // Create the \\`map\\` object with the mapboxgl.Map constructor, referencing\n  // the container div\n  let map = new maplibregl.Map({\n    container,\n    center: [40, 40],\n    zoom: 1.25,\n    pitch: 60,\n    pickingRadius: 10,\n    antialias: true,\n    style: \"style.json\"\n  });\n\n  // on map load:\n  // - dispatch its value back to ojs\n  // - add the deck.gl layer to the map\n  // - add a prop to the layer that adds/removes a popup from the map\n  //   (we can't do this on initial layer def because the map isn't ready yet)\n  map.on(\"load\", () => {\n    container.value = map;\n    container.dispatchEvent(new CustomEvent(\"input\"));\n    \n    map.addLayer(transferArcs);\n\n    function updatePopup(info, event) {\n      if (info && info.object) {\n          // TODO - set coordinates with event.center?\n          popup\n            .setLngLat(info.coordinate)\n            .setHTML(\n              `${info.object.supplier} → ${info.object.recipient}</br>\n              TIV ${info.object.count > 0 ? \"$\" + info.object.count : \"< $0.5\"} M`)\n            .addTo(map);\n        } else {\n          popup.remove();\n        }\n    }\n\n    transferArcs.setProps({\n      onHover: updatePopup\n    });\n    \n  });\n\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"\nallTransfers = FileAttachment(\"sipri-exports-processed.csv\")\n  .csv({ typed: true });\n\n/* the dataset is filtered first by selected year, then by search term\n   (we use a separate text input instead of the search's because we want to\n   retain the search term when the year changes) */\n\nfilteredTransfers = allTransfers.filter(\n  t => t.year == selectedYear && \n    (t.supplier.toLowerCase().includes(selectedCountry.toLowerCase()) ||\n     t.recipient.toLowerCase().includes(selectedCountry.toLowerCase())));\n\narcType = layerType == \"Arcs\" ? deck.ArcLayer : deck.GreatCircleLayer;\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"\ntransferArcs.setProps({ data: filteredTransfers, type: arcType });\n\n// TODO - maybe update map bounds based on bounds of currentYearTransfers?\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"micro = require(\"micromodal@0.4.10\")\nmicro.init({\n  awaitOpenAnimation: true,\n  awaitCloseAnimation: true\n});\n"},{"methodName":"interpretQuiet","source":"shinyInput('selectedYear')"},{"methodName":"interpretQuiet","source":"shinyInput('selectedCountry')"},{"methodName":"interpretQuiet","source":"shinyInput('layerType')"},{"methodName":"interpretQuiet","source":"shinyInput('map')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../importexportmap";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
  tabsets.forEach(function(tabset) {
    const tabby = new Tabby('#' + tabset.id);
  });
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>



</body></html>